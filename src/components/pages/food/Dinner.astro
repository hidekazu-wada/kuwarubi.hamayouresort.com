---
// コンポーネント
import MenuSection from './MenuSection.astro';

// 画像
import dinnerImage01 from '../../../assets/images/food/dinner/img-01.jpg';
import dinnerImage02 from '../../../assets/images/food/dinner/img-02.jpg';
import dinnerImage03 from '../../../assets/images/food/dinner/img-03.jpg';
import dinnerImage04 from '../../../assets/images/food/dinner/img-04.jpg';
import dinnerImageMain from '../../../assets/images/food/dinner/main.jpg';
import { getImage } from 'astro:assets';

// メインディナー画像の処理
const dinnerMain = await getImage({
  src: dinnerImageMain,
  format: 'webp',
  widths: [640, 1024, 1780],
});

// Dinnerセクションのプロパティ
const dinnerProps = {
  sectionName: 'dinner',
  id: 'dinner',
  title: ['山梨の豊かな自然が育んだ', '季節感溢れる夕食'],
  labelText: '夕食',
  subtitle: 'DINNER',
  description:
    'ディナータイムは、彩り豊かな料理が並ぶ心躍るビュッフェスタイルで。ずらりと並んだ一皿一皿は、料理チームがお客様の笑顔を思い描きながらしたためた「手紙」です。和食、洋食、幅広いメニューの中には、山梨の魅力を伝える一品や、遊び心を散りばめています。お子様からご年配の方まで、三世代のご家族が同じテーブルを囲んで楽しめるよう、多彩な味わいをご用意しました。選ぶ楽しさと、その奥にある私たちの想いを一緒に。一日の終わりにふさわしい食事体験をご提供します。',
  images: [
    { src: dinnerImage01, alt: '夕食の料理', widths: [330, 518] },
    { src: dinnerImage02, alt: '夕食の料理', widths: [312, 465] },
    { src: dinnerImage03, alt: '夕食の料理', widths: [373, 549] },
    { src: dinnerImage04, alt: '夕食の料理', widths: [311, 465] },
  ],
};
---

<MenuSection {...dinnerProps}>
  <!-- Dinner固有のメニューコンテンツ -->
  <aside class="dinner__menu">
    <div class="dinner__menu-main-image">
      <picture>
        <!-- デスクトップ（1024px以上）→ 最高解像度版 -->
        <source
          media="(min-width: 1024px)"
          srcset={dinnerMain.srcSet.toString()}
        />
        <!-- タブレット（744px以上）→ 中解像度版 -->
        <source
          media="(min-width: 744px)"
          srcset={dinnerMain.srcSet.toString()}
        />
        <!-- スマホ（744px未満）→ 最小解像度版 -->
        <img
          src={dinnerMain.src}
          alt="夕食の料理"
          class="dinner__menu-main-image-img"
        />
      </picture>
    </div>
    <div class="dinner__menu-content">
      <header class="dinner__menu-header">
        <h3 class="dinner__menu-title">ある日のビュッフェメニュー</h3>
        <button class="dinner__menu-toggle" type="button">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="34"
            height="34"
            viewBox="0 0 34 34"
            fill="none"
            class="dinner__menu-toggle-icon dinner__menu-toggle-icon--plus"
          >
            <path
              d="M2 17H32"
              stroke="#054965"
              stroke-width="2.66667"
              stroke-linecap="round"></path>
            <path
              d="M17 32L17 2"
              stroke="#054965"
              stroke-width="2.66667"
              stroke-linecap="round"></path>
          </svg>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="34"
            height="4"
            viewBox="0 0 34 4"
            fill="none"
            class="dinner__menu-toggle-icon dinner__menu-toggle-icon--minus"
          >
            <path
              d="M2 2H32"
              stroke="#054965"
              stroke-width="2.66667"
              stroke-linecap="round"></path>
          </svg>
        </button>
      </header>

      <div class="dinner__menu-list">
        <div class="dinner__menu-list-inner first">
          <ul class="dinner__menu-list-items">
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text"
                >カルシウムたっぷりサラダ</span
              >
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text">ポテトサラダ</span>
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text">ほうれん草の胡麻和え</span>
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text">若鶏のオーブン焼き</span>
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text">本格麻婆豆腐</span>
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text"
                >牛肉とトマトのラグーペンネ</span
              >
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text"
                >サーモンのグリル バター醤油</span
              >
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text">海老マヨ</span>
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text"
                >イカとパプリカのオイスターソース炒め</span
              >
            </li>
            <li class="dinner__menu-item dinner__menu-item--special">
              <span class="dinner__menu-item-title">串揚げステーション</span>
              <span class="dinner__menu-item-description">
                鶏ささみ大葉、うずら玉子、レンコン、カボチャ、特製ソース
              </span>
            </li>
          </ul>
        </div>
        <div class="dinner__menu-list-inner second">
          <ul class="dinner__menu-list-items">
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text">豚肉と玉子の中華炒め</span>
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text">ご飯</span>
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text"
                >赤だしの味噌汁- 長ネギ、なめこ</span
              >
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text"
                >ご飯のお供（納豆、味付け海苔）</span
              >
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text">料理長のすき焼き</span>
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text"
                >ハンバーグ - ドミグラスチーズソース</span
              >
            </li>
            <li class="dinner__menu-item dinner__menu-item--special">
              <span class="dinner__menu-item-title">デザート</span>
              <span class="dinner__menu-item-description">
                プチシュー、3種のベリー大福、グレープフルーツ、
                全粒粉ミニ食パン、クロワッサン、はちみつ豆乳パン
              </span>
            </li>
            <li class="dinner__menu-item">
              <span class="dinner__menu-item-text"
                >ホットドリンク(コーヒー、紅茶)</span
              >
            </li>
          </ul>
        </div>
      </div>
    </div>
  </aside>
</MenuSection>

<style lang="scss">
  @import '../../../styles/variables';
  @import '../../../styles/functions';
  @import '../../../styles/mixins';

  :global(.dinner) {
    padding-top: spx(100);
    padding-bottom: spx(130);
    @include tablet-up {
      padding-top: ppx(166 * 1.2);
      padding-bottom: ppx(250 * 1.2);
    }
    @include desktop-up {
      padding-top: ppx(166);
      padding-bottom: ppx(250);
    }
  }

  // Dinner固有のメニュスタイル
  .dinner {
    &__menu {
      margin-top: spx(80);
      @include tablet-up {
        margin-top: ppx(125 * 1.2);
      }
      @include desktop-up {
        margin-top: ppx(125);
      }
      &-main-image {
        &-img {
          display: block;
          width: spx(640);
          height: spx(335);
          border-radius: 0 spx(20) spx(20) 0;
          object-fit: cover;
          @include tablet-up {
            width: ppx(1780 * 1.2);
            height: ppx(933 * 1.2);
            border-radius: 0 ppx(20 * 1.2) ppx(20 * 1.2) 0;
          }
          @include desktop-up {
            width: ppx(1780);
            height: ppx(933);
            border-radius: 0 ppx(20) ppx(20) 0;
          }
        }
      }

      &-content {
        display: flex;
        width: spx(640);
        padding: spx(40) 0;
        flex-direction: column;
        align-items: center;
        border-radius: spx(20);
        background: var(--white, #fff);
        margin-inline: auto;
        margin-top: spx(80);
        @include tablet-up {
          width: ppx(1839 * 1.2);
          border-radius: ppx(30 * 1.2) 0 0 ppx(30 * 1.2);
          padding: ppx(546 * 1.2) 0 ppx(93 * 1.2);
          margin-right: 0;
          margin-top: ppx(-454 * 1.2);
        }
        @include desktop-up {
          width: ppx(1839);
          border-radius: ppx(30) 0 0 ppx(30);
          padding: ppx(546) 0 ppx(93);
          margin-top: ppx(-454);
        }
      }

      &-header {
        display: grid;
        grid-template-columns: max-content max-content;
        gap: spx(50);
        &.is-clickable {
          cursor: pointer;
        }
        @include tablet-up {
          display: block;
        }
        @include desktop-up {
        }
      }

      &-title {
        color: var(--blue_6, #054965);
        font-family: 'Zen Kaku Gothic New';
        font-size: spx(36);
        font-style: normal;
        font-weight: 400;
        line-height: 100%;
        @include tablet-up {
          font-size: ppx(40 * 1.2);
          line-height: 110%;
        }
        @include desktop-up {
          font-size: ppx(40);
        }
      }

      &-toggle {
        width: spx(30);
        height: spx(30);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        @include tablet-up {
          display: none;
        }
        @include desktop-up {
        }

        &-icon {
          display: block;
          width: 100%;
          height: auto;
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          transition:
            opacity 0.3s ease-in-out,
            visibility 0.3s ease-in-out;
          @include tablet-up {
          }
          @include desktop-up {
          }

          &--plus {
            opacity: 0;
            visibility: hidden;
            @include tablet-up {
            }
            @include desktop-up {
            }
          }

          &--minus {
            opacity: 1;
            visibility: visible;
            @include tablet-up {
            }
            @include desktop-up {
            }
          }
        }
      }

      &-list {
        display: flex;
        flex-direction: column;
        gap: spx(15);
        width: spx(538);
        margin-top: spx(60);
        position: relative;
        max-height: spx(2000);
        overflow: hidden;
        transition:
          max-height 0.4s ease-in-out,
          opacity 0.3s ease-in-out,
          visibility 0.3s ease-in-out,
          margin-top 0.4s ease-in-out;
        opacity: 1;
        visibility: visible;

        &.is-closed {
          max-height: 0;
          opacity: 0;
          visibility: hidden;
          margin-top: 0;
        }

        @include tablet-up {
          flex-direction: row;
          gap: ppx(126 * 1.2);
          width: auto;
          margin-top: ppx(73 * 1.2);
          max-height: none !important;
          opacity: 1 !important;
          visibility: visible !important;
        }
        @include desktop-up {
          gap: ppx(126);
          margin-top: ppx(73);
        }
        &::before {
          @include tablet-up {
            content: '';
            display: block;
            background: linear-gradient(
                to bottom,
                #59a1c0,
                #59a1c0 25%,
                rgba(0, 0, 0, 0) 25%,
                rgba(0, 0, 0, 0) 100%
              )
              0% 0%;
            background-size: 1px 4px;
            width: 1px;
            height: 100%;
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
          }
          @include desktop-up {
          }
        }
      }

      &-list-inner {
        &.first {
          @include tablet-up {
            width: ppx(697 * 1.2);
          }
          @include desktop-up {
            width: ppx(697);
          }
        }
        &.second {
          @include tablet-up {
            width: ppx(697 * 1.2);
          }
          @include desktop-up {
            width: ppx(697);
          }
        }
      }

      &-list-items {
        display: flex;
        flex-direction: column;
        gap: spx(15);
        @include tablet-up {
          gap: 0;
        }
        @include desktop-up {
        }
      }

      &-item {
        color: var(--blue_6, #054965);
        font-family: 'Zen Kaku Gothic New';
        font-size: spx(28);
        font-style: normal;
        font-weight: 400;
        line-height: 130%;
        letter-spacing: spx(-0.28);
        @include tablet-up {
          font-size: ppx(26 * 1.2);
          line-height: 210%;
        }
        @include desktop-up {
          font-size: ppx(26);
        }

        &--special {
          @include tablet-up {
          }
          @include desktop-up {
          }
        }

        &-text {
          display: grid;
          grid-template-columns: max-content auto;
          gap: spx(10);
          @include tablet-up {
            gap: ppx(10 * 1.2);
          }
          @include desktop-up {
            gap: ppx(10);
          }
          &::before {
            content: '・';
            display: block;
          }
        }

        &-title {
          display: grid;
          grid-template-columns: max-content auto;
          gap: spx(10);
          @include tablet-up {
            gap: ppx(10 * 1.2);
          }
          @include desktop-up {
            gap: ppx(10);
          }
          &::before {
            content: '・';
            display: block;
          }
        }

        &-description {
          display: block;
          margin-left: 1.5em;
          @include tablet-up {
          }
          @include desktop-up {
          }
        }
      }
    }
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // メニュー開閉機能（スマホのみ）
    const menuTitle = document.querySelector('.dinner__menu-title');
    const menuToggle = document.querySelector('.dinner__menu-toggle');
    const menuList = document.querySelector('.dinner__menu-list');
    const menuHeader = document.querySelector('.dinner__menu-header');
    const plusIcon = document.querySelector(
      '.dinner__menu-toggle-icon--plus'
    ) as HTMLElement;
    const minusIcon = document.querySelector(
      '.dinner__menu-toggle-icon--minus'
    ) as HTMLElement;

    if (menuTitle && menuToggle && menuList && menuHeader) {
      // 初期状態を閉じた状態に設定（スマホのみ）
      const isMobile = window.matchMedia('(max-width: 743px)');

      const initializeMenu = () => {
        if (isMobile.matches) {
          menuList.classList.add('is-closed');
          menuHeader.classList.add('is-clickable');
          if (plusIcon && minusIcon) {
            plusIcon.style.opacity = '1';
            plusIcon.style.visibility = 'visible';
            minusIcon.style.opacity = '0';
            minusIcon.style.visibility = 'hidden';
          }
        } else {
          menuList.classList.remove('is-closed');
          menuHeader.classList.remove('is-clickable');
        }
      };

      const toggleMenu = () => {
        if (!isMobile.matches) return;

        menuList.classList.toggle('is-closed');

        if (plusIcon && minusIcon) {
          if (menuList.classList.contains('is-closed')) {
            plusIcon.style.opacity = '1';
            plusIcon.style.visibility = 'visible';
            minusIcon.style.opacity = '0';
            minusIcon.style.visibility = 'hidden';
          } else {
            plusIcon.style.opacity = '0';
            plusIcon.style.visibility = 'hidden';
            minusIcon.style.opacity = '1';
            minusIcon.style.visibility = 'visible';
          }
        }
      };

      // 初期化
      initializeMenu();

      // イベントリスナー
      menuTitle.addEventListener('click', toggleMenu);
      menuToggle.addEventListener('click', toggleMenu);

      // リサイズ時の処理
      isMobile.addEventListener('change', initializeMenu);
    }
  });
</script>
