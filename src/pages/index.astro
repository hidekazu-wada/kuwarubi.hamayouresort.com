---
// メインSCSSファイルをインポート
import '../styles/main.scss';
import BottomBar from '../components/BottomBar.astro';
import MenuOverlay from '../components/MenuOverlay.astro';
import Sidebar from '../components/Sidebar.astro';
import Footer from '../components/Footer.astro';
---

<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>Astro</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Zen+Kaku+Gothic+New:wght@400;500;900&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="layout-container">
      <!-- サイドバー -->
      <Sidebar />
      <!-- スマホ専用の下部固定バー -->
      <BottomBar />
      <!-- メニューオーバーレイ -->
      <MenuOverlay />
      <!-- メインコンテンツ -->
      <main class="main-content">
        <h1>ようこそ！</h1>
        <p>これはAstroプロジェクトの基本的な構造です。</p>
      </main>
      <!-- フッター -->
      <Footer />
    </div>

    <script>
      const pcMenuToggle = document.getElementById('menu-toggle');
      const mobileMenuToggle = document.querySelector('.bottom-bar__toggle');
      const mobileMenuClose = document.querySelector('.menu-overlay__close');
      const menuOverlay = document.getElementById('menu-overlay');
      const sidebar = document.querySelector('.sidebar');

      // メニュー状態管理
      let isMenuOpen = false;

      // メニュー開閉の共通関数
      function toggleMenu() {
        if (!menuOverlay) return;

        isMenuOpen = !isMenuOpen;

        if (isMenuOpen) {
          menuOverlay.classList.add('show');
          if (sidebar) {
            sidebar.classList.add('menu-open');
          }
          // スクロールを禁止
          document.body.style.overflow = 'hidden';
        } else {
          menuOverlay.classList.remove('show');
          if (sidebar) {
            sidebar.classList.remove('menu-open');
          }
          // スクロールを復元
          document.body.style.overflow = '';
        }
      }

      // メニューを閉じる関数
      function closeMenu() {
        if (!menuOverlay) return;

        isMenuOpen = false;
        menuOverlay.classList.remove('show');
        if (sidebar) {
          sidebar.classList.remove('menu-open');
        }
        // スクロールを復元
        document.body.style.overflow = '';
      }

      // 必要な要素が存在することを確認してイベントリスナーを設定
      if (menuOverlay) {
        // PCメニューボタン
        if (pcMenuToggle) {
          pcMenuToggle.addEventListener('click', toggleMenu);
        }

        // スマホメニュー開くボタン
        if (mobileMenuToggle) {
          mobileMenuToggle.addEventListener('click', toggleMenu);
        }

        // スマホメニュー閉じるボタン
        if (mobileMenuClose) {
          mobileMenuClose.addEventListener('click', closeMenu);
        }
      }
    </script>
  </body>

  <style lang="scss">
    // 必要なmixin/functionをインポート
    @import '../styles/variables';
    @import '../styles/functions';
    @import '../styles/mixins';

    /* 基本構造 */
    .layout-container {
      display: grid;
      grid-template:
        'main'
        'footer'
        /1fr;
      min-height: 100vh;
      @include tablet-up {
        grid-template:
          'sidebar main'
          'sidebar footer'
          / tpx($sidebar-width) 1fr;
      }
      @include desktop-up {
        grid-template:
          'sidebar main'
          'sidebar footer'
          / ppx($sidebar-width) 1fr;
      }
    }

    /* メインコンテンツ */
    .main-content {
      grid-area: main;
    }
  </style>
</html>
