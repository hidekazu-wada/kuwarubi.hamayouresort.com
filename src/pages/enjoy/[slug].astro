---
// 動的ルーティングページ - 過ごし方プランの詳細表示
import BaseLayout from '../../layouts/BaseLayout.astro';
import Breadcrumb from '../../components/ui/Breadcrumb.astro';
import Hero from '../../components/pages/enjoy/Hero.astro';
import DaySchedule from '../../components/pages/enjoy/DaySchedule.astro';

// データのインポート
import { getStayPlanBySlug, getAllStayPlanSlugs } from '../../data/schedules';

// 動的ルーティングの設定
export async function getStaticPaths() {
  const slugs = getAllStayPlanSlugs();
  return slugs.map((slug) => ({
    params: { slug },
  }));
}

// ページのパラメータを取得
const { slug } = Astro.params;

// プランデータを取得
const stayPlan = getStayPlanBySlug(slug!);

// プランが見つからない場合は404
if (!stayPlan) {
  return Astro.redirect('/404');
}

// ページメタ情報
const pageTitle = `${stayPlan.title} | 光風閣くわるび`;
const pageDescription = stayPlan.description;
const pageClass = `main-content--enjoy main-content--enjoy-${stayPlan.id}`;
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  pageClass={pageClass}
>
  <!-- メインコンテンツ -->
  <Hero heroContent={stayPlan.hero} />

  <!-- 各日のスケジュール表示 -->
  {
    stayPlan.days.map((dayData) => (
      <section
        class="day-section"
        data-day-id={dayData.dayId}
        data-plan-id={stayPlan.id}
      >
        <DaySchedule dayData={dayData} stayPlanId={stayPlan.id} />
        <div class="breadcrumb-wrapper">
          <Breadcrumb
            items={[
              { text: 'TOP', href: '/' },
              { text: '過ごし方', href: '/enjoy' },
              { text: stayPlan.title },
            ]}
          />
        </div>
      </section>
    ))
  }
</BaseLayout>

<style lang="scss">
  @import '../../styles/variables';
  @import '../../styles/functions';
  @import '../../styles/mixins';

  // ============================================================
  // enjoyページのスタイル
  // ============================================================

  :global(.main-content--enjoy) {
    padding-top: spx(110);
    @include tablet-up {
      padding-top: ppx(280 * 1.2);
    }
    @include desktop-up {
      padding-top: ppx(280);
    }
  }

  // ============================================================
  // Day セクション共通スタイル
  // ============================================================

  .day-section {
    padding-top: spx(120);
    padding-bottom: spx(40);
    overflow-x: hidden;
    @include tablet-up {
      padding-top: ppx(235 * 1.2);
      padding-bottom: ppx(70 * 1.2);
    }
    @include desktop-up {
      padding-top: ppx(235);
      padding-bottom: ppx(70);
    }

    // Day1〜10までの背景色を事前定義
    // 奇数日は青い背景、偶数日は薄い青背景
    &[data-day-id='day1'] {
      background: var(--blue_2, #e7f3f9);
    }
    &[data-day-id='day2'] {
      background: var(--blue_3, #d8edf7);
    }
    &[data-day-id='day3'] {
      background: var(--blue_2, #e7f3f9);
    }
    &[data-day-id='day4'] {
      background: var(--blue_3, #d8edf7);
    }
    &[data-day-id='day5'] {
      background: var(--blue_2, #e7f3f9);
    }
    &[data-day-id='day6'] {
      background: var(--blue_3, #d8edf7);
    }
    &[data-day-id='day7'] {
      background: var(--blue_2, #e7f3f9);
    }
    &[data-day-id='day8'] {
      background: var(--blue_3, #d8edf7);
    }
    &[data-day-id='day9'] {
      background: var(--blue_2, #e7f3f9);
    }
    &[data-day-id='day10'] {
      background: var(--blue_3, #d8edf7);
    }

    .breadcrumb-wrapper {
      margin-top: spx(120);
      @include tablet-up {
        margin-top: ppx(150 * 1.2);
      }
      @include desktop-up {
        margin-top: ppx(150);
      }
    }
  }
</style>
