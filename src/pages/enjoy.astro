---
// ============================================================
// 汎用ページテンプレート
// 使い方：このファイルをコピーして、ファイル名を変更して使用
// 例：cp src/pages/_template.astro src/pages/about.astro
// ============================================================

// 必須インポート
import BaseLayout from '../layouts/BaseLayout.astro';
import Breadcrumb from '../components/ui/Breadcrumb.astro';

import Hero from '../components/pages/enjoy/Hero.astro';

// Swiper CSS
import 'swiper/css';
import 'swiper/css/thumbs';

// 追加インポート（必要に応じて）
// import { getImage } from 'astro:assets';
// import sampleImage from '../assets/images/sample.jpg';

// ============================================================
// TODO: 以下の項目を必ず変更してください
// ============================================================

// ページメタ情報（必ず変更）
const pageTitle = '過ごし方 | 光風閣くわるび';
const pageDescription = 'ページの説明文をここに記述します。';

// ページ固有のクラス名（enjoyを適切な名前に変更）
const pageClass = 'main-content--enjoy';
---

<BaseLayout
  title={pageTitle}
  description={pageDescription}
  pageClass={pageClass}
>
  <!-- ============================================================ -->
  <!-- TODO: titleEn, titleJa, Breadcrumbのテキストを変更 -->
  <!-- ============================================================ -->

  <!-- メインコンテンツ -->
  <Hero />
  <section class="day-1">
    <h2 class="day-1__heading">Day 1</h2>
    <div class="day-1__content">
      <div class="day-1__timeline">
        <!-- サムネイルSwiper -->
        <div class="enjoy-day1__swiper-thumb">
          <ol class="day-1__schedule-list swiper-wrapper">
            <li class="day-1__schedule-item swiper-slide">
              <div class="day-1__schedule-entry">
                <time class="day-1__time">15:00</time>
                <span class="day-1__connector"></span>
                <span class="day-1__activity">チェックイン</span>
              </div>
            </li>
            <li class="day-1__schedule-item swiper-slide">
              <div class="day-1__schedule-entry">
                <time class="day-1__time">15:30</time>
                <span class="day-1__connector"></span>
                <span class="day-1__activity">周辺散歩</span>
              </div>
            </li>
            <li class="day-1__schedule-item swiper-slide">
              <div class="day-1__schedule-entry">
                <time class="day-1__time">16:00</time>
                <span class="day-1__connector"></span>
                <span class="day-1__activity">森のサウナ</span>
              </div>
            </li>
            <li class="day-1__schedule-item swiper-slide">
              <div class="day-1__schedule-entry">
                <time class="day-1__time">18:00</time>
                <span class="day-1__connector"></span>
                <span class="day-1__activity">夕　食</span>
              </div>
            </li>
            <li class="day-1__schedule-item swiper-slide">
              <div class="day-1__schedule-entry">
                <time class="day-1__time">19:00</time>
                <span class="day-1__connector"></span>
                <span class="day-1__activity">入　浴</span>
              </div>
            </li>
            <li class="day-1__schedule-item swiper-slide">
              <div class="day-1__schedule-entry">
                <time class="day-1__time">20:30</time>
                <span class="day-1__connector"></span>
                <span class="day-1__activity">ナイトハイク</span>
              </div>
            </li>
            <li class="day-1__schedule-item swiper-slide">
              <div class="day-1__schedule-entry">
                <time class="day-1__time">22:00</time>
                <span class="day-1__connector"></span>
                <span class="day-1__activity">就　寝</span>
              </div>
            </li>
          </ol>
        </div>
        <span class="day-1__vertical-line"></span>
      </div>
      <div class="day-1__details">
        <!-- メインSwiper -->
        <div class="enjoy-day1__swiper-main">
          <div class="day-1__details-list swiper-wrapper">
            <article class="day-1__detail-item swiper-slide">
              <div class="day-1__detail-content">
                <div class="day-1__detail-image">
                  <picture class="day-1__picture">
                    <!-- デスクトップ（1024px以上）→ 最高解像度版 -->
                    <source media="(min-width: 1024px)" srcset="/" />
                    <!-- タブレット（744px以上）→ 中解像度版 -->
                    <source media="(min-width: 744px)" srcset="/" />
                    <!-- スマホ（744px未満）→ 最小解像度版 -->
                    <img
                      src='alt="画像の内容を説明するテキスト"'
                      class="day-1__img"
                    />
                  </picture>
                </div>
                <div class="day-1__detail-text">
                  <time class="day-1__detail-time">15:00</time>
                  <h3 class="day-1__detail-title">チェックイン</h3>
                  <p class="day-1__detail-description">
                    静謐な西湖の湖畔に佇むホテルへ、木々のざわめきが出迎えてくれます。チェックインカウンターでは、清々しい山の空気と共に、穏やかなスタッフの笑顔がお待ちしています。荷物を預け、深呼吸一つで、日常のせわしなさが溶けていくのを感じていただけるはずです。
                  </p>
                </div>
              </div>
            </article>
            <article class="day-1__detail-item swiper-slide">
              <div class="day-1__detail-content">
                <div class="day-1__detail-image">
                  <picture class="day-1__picture">
                    <!-- デスクトップ（1024px以上）→ 最高解像度版 -->
                    <source media="(min-width: 1024px)" srcset="/" />
                    <!-- タブレット（744px以上）→ 中解像度版 -->
                    <source media="(min-width: 744px)" srcset="/" />
                    <!-- スマホ（744px未満）→ 最小解像度版 -->
                    <img
                      src='alt="画像の内容を説明するテキスト"'
                      class="day-1__img"
                    />
                  </picture>
                </div>
                <div class="day-1__detail-text">
                  <time class="day-1__detail-time">15:30</time>
                  <h3 class="day-1__detail-title">周辺散歩</h3>
                  <p class="day-1__detail-description">
                    静謐な西湖の湖畔に佇むホテルへ、木々のざわめきが出迎えてくれます。チェックインカウンターでは、清々しい山の空気と共に、穏やかなスタッフの笑顔がお待ちしています。荷物を預け、深呼吸一つで、日常のせわしなさが溶けていくのを感じていただけるはずです。
                  </p>
                </div>
              </div>
            </article>
            <article class="day-1__detail-item swiper-slide">
              <div class="day-1__detail-content">
                <div class="day-1__detail-image">
                  <picture class="day-1__picture">
                    <!-- デスクトップ（1024px以上）→ 最高解像度版 -->
                    <source media="(min-width: 1024px)" srcset="/" />
                    <!-- タブレット（744px以上）→ 中解像度版 -->
                    <source media="(min-width: 744px)" srcset="/" />
                    <!-- スマホ（744px未満）→ 最小解像度版 -->
                    <img
                      src='alt="画像の内容を説明するテキスト"'
                      class="day-1__img"
                    />
                  </picture>
                </div>
                <div class="day-1__detail-text">
                  <time class="day-1__detail-time">16:00</time>
                  <h3 class="day-1__detail-title">森のサウナ</h3>
                  <p class="day-1__detail-description">
                    静謐な西湖の湖畔に佇むホテルへ、木々のざわめきが出迎えてくれます。チェックインカウンターでは、清々しい山の空気と共に、穏やかなスタッフの笑顔がお待ちしています。荷物を預け、深呼吸一つで、日常のせわしなさが溶けていくのを感じていただけるはずです。
                  </p>
                </div>
              </div>
            </article>
            <article class="day-1__detail-item swiper-slide">
              <div class="day-1__detail-content">
                <div class="day-1__detail-image">
                  <picture class="day-1__picture">
                    <!-- デスクトップ（1024px以上）→ 最高解像度版 -->
                    <source media="(min-width: 1024px)" srcset="/" />
                    <!-- タブレット（744px以上）→ 中解像度版 -->
                    <source media="(min-width: 744px)" srcset="/" />
                    <!-- スマホ（744px未満）→ 最小解像度版 -->
                    <img
                      src='alt="画像の内容を説明するテキスト"'
                      class="day-1__img"
                    />
                  </picture>
                </div>
                <div class="day-1__detail-text">
                  <time class="day-1__detail-time">18:00</time>
                  <h3 class="day-1__detail-title">夕　食</h3>
                  <p class="day-1__detail-description">
                    静謐な西湖の湖畔に佇むホテルへ、木々のざわめきが出迎えてくれます。チェックインカウンターでは、清々しい山の空気と共に、穏やかなスタッフの笑顔がお待ちしています。荷物を預け、深呼吸一つで、日常のせわしなさが溶けていくのを感じていただけるはずです。
                  </p>
                </div>
              </div>
            </article>
            <article class="day-1__detail-item swiper-slide">
              <div class="day-1__detail-content">
                <div class="day-1__detail-image">
                  <picture class="day-1__picture">
                    <!-- デスクトップ（1024px以上）→ 最高解像度版 -->
                    <source media="(min-width: 1024px)" srcset="/" />
                    <!-- タブレット（744px以上）→ 中解像度版 -->
                    <source media="(min-width: 744px)" srcset="/" />
                    <!-- スマホ（744px未満）→ 最小解像度版 -->
                    <img
                      src='alt="画像の内容を説明するテキスト"'
                      class="day-1__img"
                    />
                  </picture>
                </div>
                <div class="day-1__detail-text">
                  <time class="day-1__detail-time">19:00</time>
                  <h3 class="day-1__detail-title">入　浴</h3>
                  <p class="day-1__detail-description">
                    静謐な西湖の湖畔に佇むホテルへ、木々のざわめきが出迎えてくれます。チェックインカウンターでは、清々しい山の空気と共に、穏やかなスタッフの笑顔がお待ちしています。荷物を預け、深呼吸一つで、日常のせわしなさが溶けていくのを感じていただけるはずです。
                  </p>
                </div>
              </div>
            </article>
            <article class="day-1__detail-item swiper-slide">
              <div class="day-1__detail-content">
                <div class="day-1__detail-image">
                  <picture class="day-1__picture">
                    <!-- デスクトップ（1024px以上）→ 最高解像度版 -->
                    <source media="(min-width: 1024px)" srcset="/" />
                    <!-- タブレット（744px以上）→ 中解像度版 -->
                    <source media="(min-width: 744px)" srcset="/" />
                    <!-- スマホ（744px未満）→ 最小解像度版 -->
                    <img
                      src='alt="画像の内容を説明するテキスト"'
                      class="day-1__img"
                    />
                  </picture>
                </div>
                <div class="day-1__detail-text">
                  <time class="day-1__detail-time">20:30</time>
                  <h3 class="day-1__detail-title">ナイトハイク</h3>
                  <p class="day-1__detail-description">
                    静謐な西湖の湖畔に佇むホテルへ、木々のざわめきが出迎えてくれます。チェックインカウンターでは、清々しい山の空気と共に、穏やかなスタッフの笑顔がお待ちしています。荷物を預け、深呼吸一つで、日常のせわしなさが溶けていくのを感じていただけるはずです。
                  </p>
                </div>
              </div>
            </article>
            <article class="day-1__detail-item swiper-slide">
              <div class="day-1__detail-content">
                <div class="day-1__detail-image">
                  <picture class="day-1__picture">
                    <!-- デスクトップ（1024px以上）→ 最高解像度版 -->
                    <source media="(min-width: 1024px)" srcset="/" />
                    <!-- タブレット（744px以上）→ 中解像度版 -->
                    <source media="(min-width: 744px)" srcset="/" />
                    <!-- スマホ（744px未満）→ 最小解像度版 -->
                    <img
                      src='alt="画像の内容を説明するテキスト"'
                      class="day-1__img"
                    />
                  </picture>
                </div>
                <div class="day-1__detail-text">
                  <time class="day-1__detail-time">22:00</time>
                  <h3 class="day-1__detail-title">就　寝</h3>
                  <p class="day-1__detail-description">
                    静謐な西湖の湖畔に佇むホテルへ、木々のざわめきが出迎えてくれます。チェックインカウンターでは、清々しい山の空気と共に、穏やかなスタッフの笑顔がお待ちしています。荷物を預け、深呼吸一つで、日常のせわしなさが溶けていくのを感じていただけるはずです。
                  </p>
                </div>
              </div>
            </article>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- パンくずリスト -->
  <div class="breadcrumb-wrapper">
    <Breadcrumb items={[{ text: 'TOP', href: '/' }, { text: '過ごし方' }]} />
  </div>
</BaseLayout>

<script>
  // @ts-nocheck
  // Swiper型定義の問題を一時的に無効化（動作には影響なし）
  import Swiper from 'swiper';

  // ブレークポイント定数（744px = タブレット以上でSwiper有効）
  const TABLET_BP = 744;
  const isTabletUp = () =>
    window.matchMedia(`(min-width: ${TABLET_BP}px)`).matches;

  document.addEventListener('DOMContentLoaded', () => {
    let thumbsSwiper: any = null;
    let mainSwiper: any = null;

    const initSwipers = () => {
      // 既に初期化済みなら何もしない（二重初期化防止）
      if (mainSwiper || thumbsSwiper) return;

      // サムネイルSwiper初期化
      // @ts-ignore
      thumbsSwiper = new Swiper('.enjoy-day1__swiper-thumb', {
        spaceBetween: 10,
        slidesPerView: 7, // デフォルトで7つ表示
        freeMode: true,
        watchSlidesProgress: true,
        slideToClickedSlide: true, // クリックしたスライドに移動
        breakpoints: {
          744: {
            slidesPerView: 5, // タブレットで5つ
          },
          1024: {
            slidesPerView: 7, // PCで7つ
          },
        },
      });

      // メインSwiper初期化
      // @ts-ignore
      mainSwiper = new Swiper('.enjoy-day1__swiper-main', {
        spaceBetween: 10,
        slidesPerView: 1,
        thumbs: {
          swiper: thumbsSwiper,
        },
      });

      // サムネイルクリックイベントを手動で追加
      const thumbSlides = document.querySelectorAll('.enjoy-day1__swiper-thumb .swiper-slide');
      thumbSlides.forEach((slide, index) => {
        slide.addEventListener('click', () => {
          if (mainSwiper) {
            mainSwiper.slideTo(index);
          }
        });
      });
    };

    const destroySwipers = () => {
      // destroy(true, true) = 完全クリーンアップ
      // 第1引数: deleteInstance（インスタンス削除）
      // 第2引数: cleanStyles（付与されたスタイル除去）
      if (mainSwiper) {
        mainSwiper.destroy(true, true);
        mainSwiper = null;
      }
      if (thumbsSwiper) {
        thumbsSwiper.destroy(true, true);
        thumbsSwiper = null;
      }
    };

    const handleResize = () => {
      if (isTabletUp()) {
        initSwipers(); // タブレット以上でSwiper有効
      } else {
        destroySwipers(); // スマホでSwiper無効
      }
    };

    // 初期セットアップ
    handleResize();

    // リサイズイベント（デバウンス付きで負荷軽減）
    let resizeTimer: number;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(handleResize, 150);
    });

    // MediaQueryList変更イベント（より効率的）
    // resizeイベントの代わりにこちらを使うこともできます
    const mediaQuery = window.matchMedia(`(min-width: ${TABLET_BP}px)`);
    if (mediaQuery.addEventListener) {
      mediaQuery.addEventListener('change', handleResize);
    }
  });
</script>

<style lang="scss">
  @import '../styles/variables';
  @import '../styles/functions';
  @import '../styles/mixins';

  // ============================================================
  // enjoyページのスタイル
  // ============================================================

  :global(.main-content--enjoy) {
    padding-top: spx(110);
    @include tablet-up {
      padding-top: ppx(280 * 1.2);
    }
    @include desktop-up {
      padding-top: ppx(280);
    }
  }

  // ============================================================
  // Day 1 セクション
  // ============================================================

  .day-1 {
    background: var(--blue_2, #e7f3f9);
    @include tablet-up {
    }
    @include desktop-up {
    }

    &__heading {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__content {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__timeline {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__schedule-list {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__schedule-item {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__schedule-entry {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__time {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__connector {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__activity {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__vertical-line {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__details {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__details-list {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__detail-item {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__detail-content {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__detail-image {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__picture {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__img {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__detail-text {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__detail-time {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__detail-title {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    &__detail-description {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }
  }

  // ============================================================
  // Swiper関連のセレクター
  // ============================================================

  .enjoy-day1__swiper-thumb {
    display: none;
    @include tablet-up {
      display: flex;
    }
    @include desktop-up {
    }

    .swiper-wrapper {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }

    .swiper-slide {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }
  }

  .enjoy-day1__swiper-main {
    @include tablet-up {
    }
    @include desktop-up {
    }

    .swiper-wrapper {
      flex-direction: column;
      @include tablet-up {
        flex-direction: row;
      }
      @include desktop-up {
      }
    }

    .swiper-slide {
      @include tablet-up {
      }
      @include desktop-up {
      }
    }
  }
</style>
